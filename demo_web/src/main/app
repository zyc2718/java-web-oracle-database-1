import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.sql.*;

public class UserApp extends JFrame {
    // å®šä¹‰ç•Œé¢ç»„ä»¶
    private JTextField txtUser = new JTextField(20);
    private JPasswordField txtPwd = new JPasswordField(20);
    private JButton btnAdd = new JButton("æ·»åŠ ç”¨æˆ·åˆ°æ•°æ®åº“");
    private JTextArea txtLog = new JTextArea(10, 30);

    public UserApp() {
        // 1. è®¾ç½®çª—å£åŸºæœ¬å±æ€§
        setTitle("å­¦ç”Ÿç³»ç»Ÿåå°è¿æ¥æµ‹è¯•ç¨‹åº");
        setSize(400, 350);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new FlowLayout());

        // 2. å¸ƒå±€ç•Œé¢
        add(new JLabel("ç”¨æˆ·å:"));
        add(txtUser);
        add(new JLabel("å¯†  ç :"));
        add(txtPwd);
        add(btnAdd);
        
        // æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸï¼ˆå¯è§†åŒ–åå°è¿æ¥è¿‡ç¨‹ï¼‰
        txtLog.setEditable(false);
        add(new JScrollPane(txtLog));

        // 3. ç¼–å†™æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆæ ¸å¿ƒåå°è¿æ¥é€»è¾‘ï¼‰
        btnAdd.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                connectAndInsert();
            }
        });

        setLocationRelativeTo(null); // çª—å£å±…ä¸­
        setVisible(true);
    }

    private void connectAndInsert() {
        String username = txtUser.getText();
        String password = new String(txtPwd.getPassword());
        
        // æ•°æ®åº“é…ç½®
        String url = "jdbc:mysql://localhost:3306/schooldb?serverTimezone=Asia/Shanghai";
        String dbUser = "root";
        String dbPwd = "196911Enter."; 

        try {
            txtLog.append("æ­£åœ¨å°è¯•è¿æ¥æ•°æ®åº“...\n");
            
            // åŠ è½½é©±åŠ¨
            Class.forName("com.mysql.cj.jdbc.Driver");
            
            // å»ºç«‹è¿æ¥
            Connection conn = DriverManager.getConnection(url, dbUser, dbPwd);
            txtLog.append("âœ… åå°è¿æ¥æˆåŠŸï¼\n");

            // æ‰§è¡Œæ’å…¥æ“ä½œ
            String sql = "INSERT INTO classes (username, password) VALUES (?, ?)";
            PreparedStatement ps = conn.prepareStatement(sql);
            ps.setString(1, username);
            ps.setString(2, password);
            
            int result = ps.executeUpdate();
            if (result > 0) {
                txtLog.append("ğŸš€ æ•°æ®å·²æˆåŠŸå†™å…¥æ•°æ®åº“è¡¨ [classes]\n");
                JOptionPane.showMessageDialog(null, "æ•°æ®æ·»åŠ æˆåŠŸï¼");
            }

            ps.close();
            conn.close();
            txtLog.append("è¿æ¥å·²å…³é—­ã€‚\n----------------------\n");

        } catch (Exception ex) {
            txtLog.append("âŒ é”™è¯¯: " + ex.getMessage() + "\n");
        }
    }

    public static void main(String[] args) {
        // å¯åŠ¨åº”ç”¨ç¨‹åº
        new UserApp();
    }
}